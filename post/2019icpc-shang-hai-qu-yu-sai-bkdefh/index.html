<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" >

<title>2019icpcä¸Šæµ·åŒºåŸŸèµ›B,K,D,E,F,H | nofuck</title>

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
<link rel="shortcut icon" href="https://nofuck.github.io/favicon.ico?v=1582347503862">
<link rel="stylesheet" href="https://nofuck.github.io/styles/main.css">



<link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>



    <meta name="description" content="ğŸ˜ŠğŸ˜Š
B	Prefix Code
é¢˜æ„ï¼šç»™å‡ºnä¸ªæ•°å­—(æœ‰å‰ç¼€0)ï¼Œé•¿åº¦å‡å°äº10ï¼Œé—®æ˜¯å¦æœ‰ä¸€ä¸ªæ•°æ˜¯å…¶ä»–æ•°çš„å‰ç¼€ï¼Ÿ
æ€è·¯ï¼šå­—å…¸æ ‘æŸ¥æ‰¾å³å¯ï¼Œvisè¡¨ç¤ºèµ°è¿‡çš„è·¯å¾„å’Œedæ ‡è®°ç»“å°¾ï¼Œåœ¨insertå°±å¯åˆ¤æ–­ã€‚
code
#pragma GCC op..." />
    <meta name="keywords" content="" />
  </head>
  <body>
    <div id="app" class="main">

      <div class="sidebar" :class="{ 'full-height': menuVisible }">
  <div class="top-container" data-aos="fade-right">
    <div class="top-header-container">
      <a class="site-title-container" href="https://nofuck.github.io">
        <img src="https://nofuck.github.io/images/avatar.png?v=1582347503862" class="site-logo">
        <h1 class="site-title">nofuck</h1>
      </a>
      <div class="menu-btn" @click="menuVisible = !menuVisible">
        <div class="line"></div>
      </div>
    </div>
    <div>
      
        
          <a href="/" class="site-nav">
            é¦–é¡µ
          </a>
        
      
        
          <a href="/archives" class="site-nav">
            å½’æ¡£
          </a>
        
      
        
          <a href="/tags" class="site-nav">
            æ ‡ç­¾
          </a>
        
      
        
          <a href="/post/about" class="site-nav">
            å…³äº
          </a>
        
      
    </div>
  </div>
  <div class="bottom-container" data-aos="flip-up" data-aos-offset="0">
    <div class="social-container">
      
        
          <a class="social-link" href="https://github.com/nofuck" target="_blank">
            <i class="fab fa-github"></i>
          </a>
        
      
        
      
        
      
        
      
        
      
    </div>
    <div class="site-description">
      åªæœ‰é¢“åºŸæ˜¯ä¸éœ€è¦åŠªåŠ›å¾—æ¥çš„
    </div>
    <div class="site-footer">
      Powered by <a href="https://github.com/nofuck" target="_blank">nofuck</a> | <a class="rss" href="https://nofuck.github.io/atom.xml" target="_blank">RSS</a>
    </div>
  </div>
</div>


      <div class="main-container">
        <div class="content-container" data-aos="fade-up">
          <div class="post-detail">
            <h2 class="post-title">2019icpcä¸Šæµ·åŒºåŸŸèµ›B,K,D,E,F,H</h2>
            <div class="post-date">2020-02-20</div>
            
            <div class="post-content" v-pre>
              <p>ğŸ˜ŠğŸ˜Š</p>
<h1 id="bprefix-code"><a href="https://ac.nowcoder.com/acm/contest/4370/B">B	Prefix Code</a></h1>
<p>é¢˜æ„ï¼šç»™å‡ºnä¸ªæ•°å­—(æœ‰å‰ç¼€0)ï¼Œé•¿åº¦å‡å°äº10ï¼Œé—®æ˜¯å¦æœ‰ä¸€ä¸ªæ•°æ˜¯å…¶ä»–æ•°çš„å‰ç¼€ï¼Ÿ<br>
æ€è·¯ï¼šå­—å…¸æ ‘æŸ¥æ‰¾å³å¯ï¼Œvisè¡¨ç¤ºèµ°è¿‡çš„è·¯å¾„å’Œedæ ‡è®°ç»“å°¾ï¼Œåœ¨insertå°±å¯åˆ¤æ–­ã€‚</p>
<h3 id="code">code</h3>
<pre><code class="language-cpp">#pragma GCC optimize(2)
#include&lt;bits/stdc++.h&gt;
using namespace std;
const int man = 1e4+10;
#define IOS ios::sync_with_stdio(0)
template &lt;typename T&gt;
inline T read(){T sum=0,fl=1;int ch=getchar();
for(;!isdigit(ch);ch=getchar())if(ch=='-')fl=-1;
for(;isdigit(ch);ch=getchar())sum=sum*10+ch-'0';
return sum*fl;}
template &lt;typename T&gt;
inline void write(T x) {static int sta[35];int top=0;
do{sta[top++]= x % 10, x /= 10;}while(x);
while (top) putchar(sta[--top] + 48);}
template&lt;typename T&gt;T gcd(T a, T b) {return b==0?a:gcd(b, a%b);}
template&lt;typename T&gt;T exgcd(T a,T b,T &amp;g,T &amp;x,T &amp;y){if(!b){g = a,x = 1,y = 0;}
else {exgcd(b,a%b,g,y,x);y -= x*(a/b);}}
#ifndef ONLINE_JUDGE
#define debug(fmt, ...) {printf(&quot;debug &quot;);printf(fmt,##__VA_ARGS__);puts(&quot;&quot;);}
#else
#define debug(fmt, ...)
#endif
typedef long long ll;
const ll mod = 1e9+7;

int tr[man*15][10];
int cnt = 0;
int vis[man*15];
bool ed[man*15];
bool ans;
void insert(const char *s){
    int p = 0;
    for(int i = 0;s[i];i++){
        int tp = s[i] - '0';
        if(!tr[p][tp])tr[p][tp] = ++cnt;
        p = tr[p][tp];
        if(ed[p])ans = 1;//è¿™ä¸ªæ•°åŒ…å«å…¶å®ƒå‰ç¼€
        vis[p]++;
    }
    if(vis[p]&gt;1)ans = 1;//è¿™ä¸ªæ•°ä¸ºå…¶å®ƒæ•°çš„å‰ç¼€
    ed[p] = 1;
}

void init(){
    for(int i = 0;i &lt;= cnt;i++){
        memset(tr[i],0,sizeof(tr[i]));
        vis[i] = 0;
        ed[i] = 0;
    }
    cnt = 0;
    ans = 0;
}

int main() {
    #ifndef ONLINE_JUDGE
        //freopen(&quot;in.txt&quot;, &quot;r&quot;, stdin);
        //freopen(&quot;out.txt&quot;,&quot;w&quot;,stdout);
    #endif
    int t;
    cin &gt;&gt;t;
    int T = 1;
    while(t--){
        int n;
        init();
        cin &gt;&gt; n;
        char str[15];
        while(n--){
            cin &gt;&gt; str;
            insert(str);
        }
        cout &lt;&lt; &quot;Case #&quot; &lt;&lt; T++ &lt;&lt;&quot;:&quot;;
        if(ans)cout &lt;&lt; &quot; No\n&quot;;
        else cout &lt;&lt; &quot; Yes\n&quot;;  
    }   
    return 0;
}
</code></pre>
<h1 id="kcolor-graph"><a href="https://ac.nowcoder.com/acm/contest/4370/K">K	Color Graph</a></h1>
<p>é¢˜æ„ï¼šç»™å®šä¸€ä¸ªç®€å•å›¾ï¼Œç‚¹ä¸ªæ•°&lt;=16ï¼Œå¯¹ä¸€äº›è¾¹æ¶‚è‰²ï¼Œä½¿å¾—è¯¥å›¾ä¸­æ¶‚è¿‡è‰²æ²¡æœ‰å¥‡æ•°çš„ç¯ï¼Œé—®æ¶‚è‰²çš„è¾¹æ•°æœ€å¤§ä¸ºå¤šå°‘ã€‚<br>
æ€è·¯ï¼š<strong>å¦‚æœä¸€ä¸ªå›¾ä¸­ä¸å­˜åœ¨å¥‡æ•°ç¯,é‚£ä¹ˆè¿™ä¸ªå›¾ä¸€å®šæ˜¯äºŒåˆ†å›¾(é¦–å…ˆå¦‚æœæ²¡æœ‰ç¯(æ ‘)ï¼Œé‚£ä¹ˆä¸€å®šæ˜¯äºŒåˆ†å›¾ï¼Œå¦‚æœæœ‰å¶æ•°ç¯ï¼Œé‚£ä¹ˆä»å·¦è¾¹çš„ç‚¹å‡ºå»åˆ°å³è¾¹è‚¯å®šæ˜¯å¥‡æ•°æ¬¡ï¼Œå¦‚æœè¦å›åˆ°å·¦è¾¹è‚¯å®šå¾—æ˜¯å¶æ•°ï¼Œæ‰€ä»¥ç²—ç•¥å¯å¾—ã€‚)<a href="https://www.cnblogs.com/ninedream/p/11203942.html">è¯æ˜</a></strong>ï¼Œç„¶åç‚¹æ•°å¾ˆå°ï¼Œæ‰€ä»¥äºŒè¿›åˆ¶æšä¸¾äºŒåˆ†å›¾å·¦è¾¹çš„ç‚¹æ•°ï¼Œå–ä¸ªæœ€å¤§å€¼ã€‚</p>
<h3 id="code-2">code</h3>
<pre><code class="language-cpp">#pragma GCC optimize(2)
#include&lt;bits/stdc++.h&gt;
using namespace std;
const int man = 1e4+10;
#define IOS ios::sync_with_stdio(0)
template &lt;typename T&gt;
inline T read(){T sum=0,fl=1;int ch=getchar();
for(;!isdigit(ch);ch=getchar())if(ch=='-')fl=-1;
for(;isdigit(ch);ch=getchar())sum=sum*10+ch-'0';
return sum*fl;}
template &lt;typename T&gt;
inline void write(T x) {static int sta[35];int top=0;
do{sta[top++]= x % 10, x /= 10;}while(x);
while (top) putchar(sta[--top] + 48);}
template&lt;typename T&gt;T gcd(T a, T b) {return b==0?a:gcd(b, a%b);}
template&lt;typename T&gt;T exgcd(T a,T b,T &amp;g,T &amp;x,T &amp;y){if(!b){g = a,x = 1,y = 0;}
else {exgcd(b,a%b,g,y,x);y -= x*(a/b);}}
#ifndef ONLINE_JUDGE
#define debug(fmt, ...) {printf(&quot;debug &quot;);printf(fmt,##__VA_ARGS__);puts(&quot;&quot;);}
#else
#define debug(fmt, ...)
#endif
typedef long long ll;
const ll mod = 1e9+7;

vector&lt;pair&lt;int,int&gt; &gt;sp;
bool vis[20];

int main() {
    #ifndef ONLINE_JUDGE
        //freopen(&quot;in.txt&quot;, &quot;r&quot;, stdin);
        //freopen(&quot;out.txt&quot;,&quot;w&quot;,stdout);
    #endif
    IOS;
    int t;
    cin &gt;&gt;t;
    int T = 1;
    while(t--){
        int n,m;
        cin &gt;&gt; n &gt;&gt; m;
        sp.clear();
        memset(vis,0,sizeof(vis));
        for(int i = 1;i &lt;= m;++i){
            int u,v;
            cin &gt;&gt; u &gt;&gt; v;
            sp.push_back(make_pair(u,v));
        }
        int ans = 0;
        for(int i = 0;i &lt; (1&lt;&lt;n);++i){
            int tp = i;
            for(int j = 1;j &lt;= n;j++){
                if(tp&gt;&gt;(j-1)&amp;1)vis[j] = 1;
                else vis[j] = 0;
            }
            int res = 0;
            for(int j = 0;j &lt; sp.size();++j){
                if(vis[sp[j].first]!=vis[sp[j].second])res++;
            }
            ans = max(ans,res);
        }
        cout &lt;&lt; &quot;Case #&quot; &lt;&lt; T++ &lt;&lt;&quot;: &quot;;
        cout &lt;&lt; ans &lt;&lt; endl;
    }   
    return 0;
}
</code></pre>
<h1 id="htree-partition"><a href="https://ac.nowcoder.com/acm/contest/4370/H">H	Tree Partition</a></h1>
<p>é¢˜æ„ï¼šä¸€é¢—(n&lt;=1e5)çš„æ ‘ï¼Œè¦æ±‚æŠŠå…¶åˆ†ä¸º(k&lt;=n)ä¸ªå­æ ‘ï¼Œè¦æ±‚æ¯ä¸ªå­æ ‘çš„æœ€å¤§å€¼æœ€å°ã€‚<br>
æ€è·¯ï¼šé¦–å…ˆäºŒåˆ†æœ€å¤§å€¼midï¼Œç„¶ååœ¨å¯¹äºè¿™ä¸ªæœ€å¤§å€¼checkï¼Œè®©æ¯é¢—æ ‘éƒ½å°½é‡çš„å¤§(&lt;=x)ï¼Œä»¥è‡´äºæˆ‘ä»¬ç çš„æ¬¡æ•°å°‘ï¼Œå¦‚æœç çš„æ¬¡æ•°å¤šäº†ï¼Œé‚£ä¹ˆè¯´æ˜è¿™ä¸ªmaxå°äº†ï¼Œåä¹‹åˆ™å¤§äº†ã€‚</p>
<h3 id="code-3">code</h3>
<pre><code class="language-cpp">#pragma GCC optimize(2)
#include&lt;bits/stdc++.h&gt;
using namespace std;
const int man = 2e5+10;
#define IOS ios::sync_with_stdio(0)
template &lt;typename T&gt;
inline T read(){T sum=0,fl=1;int ch=getchar();
for(;!isdigit(ch);ch=getchar())if(ch=='-')fl=-1;
for(;isdigit(ch);ch=getchar())sum=sum*10+ch-'0';
return sum*fl;}
template &lt;typename T&gt;
inline void write(T x) {static int sta[35];int top=0;
do{sta[top++]= x % 10, x /= 10;}while(x);
while (top) putchar(sta[--top] + 48);}
template&lt;typename T&gt;T gcd(T a, T b) {return b==0?a:gcd(b, a%b);}
template&lt;typename T&gt;T exgcd(T a,T b,T &amp;g,T &amp;x,T &amp;y){if(!b){g = a,x = 1,y = 0;}
else {exgcd(b,a%b,g,y,x);y -= x*(a/b);}}
#ifndef ONLINE_JUDGE
#define debug(fmt, ...) {printf(&quot;debug &quot;);printf(fmt,##__VA_ARGS__);puts(&quot;&quot;);}
#else
#define debug(fmt, ...)
#endif
typedef long long ll;
const ll mod = 1e9+7;
vector&lt;int&gt;sp[man];
int tp[man];
ll va[man];
const ll inf = 1e18;
ll mid;
int kk;

struct node{
    int u;
    node(int u = 0):u(u){}
    bool operator &lt; (const node &amp;t)const{
        return va[u] &lt; va[t.u];
    }
};


ll dfs(int u,int f){
    priority_queue&lt;node&gt;q;
    for(int i = 0;i &lt; sp[u].size();i++){
        int v = sp[u][i];
        if(v==f)continue;
        va[u] += dfs(v,u);
        q.push(node(v));
    }
    while(va[u]&gt;mid&amp;&amp;!q.empty()){
        va[u] -= va[q.top().u];
        q.pop();
        kk++;
    }
    while(!q.empty())q.pop();
    return va[u];
}

int main() {
    #ifndef ONLINE_JUDGE
        //freopen(&quot;in.txt&quot;, &quot;r&quot;, stdin);
        //freopen(&quot;out.txt&quot;,&quot;w&quot;,stdout);
    #endif
    int t;
    int T = 0;
    scanf(&quot;%d&quot;,&amp;t);
    while(t--){
        int k,n;
        scanf(&quot;%d%d&quot;,&amp;n,&amp;k);
        //while(!q.empty())q.pop();
        for(int i = 1;i &lt;= n;i++)sp[i].clear();
        for(int i = 1;i &lt; n;i++){
            int u,v;
            scanf(&quot;%d%d&quot;,&amp;u,&amp;v);
            sp[u].push_back(v);
            sp[v].push_back(u);
        }
        ll l = 0,r = inf;
        for(int i = 1;i &lt;= n;i++)scanf(&quot;%d&quot;,&amp;tp[i]),l = max(l,1ll*tp[i]);
        ll ans = 0;
        while(l&lt;=r){
            mid = l + r &gt;&gt; 1;
            for(int i = 1;i &lt;= n;i++)va[i] = tp[i];
            kk = 0;
            dfs(1,0);
            if(kk+1&lt;=k)r = mid - 1,ans = mid;
            else l = mid + 1; 
        }
        printf(&quot;Case #%d: %lld\n&quot;,++T,ans);
    }
    return 0;
}
</code></pre>
<h1 id="dspanning-tree-removal"><a href="https://ac.nowcoder.com/acm/contest/4370/D">D	Spanning Tree Removal</a></h1>
<p>é¢˜æ„ï¼šç»™å®šä¸€ä¸ªnçš„å®Œå…¨å›¾ï¼Œæ¯æ¬¡æ“ä½œæ˜¯ä»å›¾ä¸­ç§»é™¤ä¸€æ£µç”Ÿæˆæ ‘çš„æ‰€æœ‰è¾¹ï¼Œé—®æœ€å¤šèƒ½è¿›è¡Œå¤šå°‘æ¬¡è¿™æ ·çš„æ“ä½œï¼Ÿè¾“å‡ºæ“ä½œæ¬¡æ•°å’Œæ¯æ¬¡ç§»é™¤çš„ç”Ÿæˆæ ‘çš„è¾¹ã€‚<br>
æ€è·¯ï¼šè¾¹n*(n-1)/2,æ¯é¢—ç”Ÿæˆæ ‘ä¸ºn-1æ¡è¾¹ï¼Œæ‰€ä»¥çŒœæµ‹n/2æ¡è¾¹ï¼Œæ„é€ æ–¹æ³•çš„è¯ä¹Ÿæ¯”è¾ƒå·§;<br>
æ‰€æœ‰ç‚¹é¡ºæ—¶é’ˆç¼–å·(0~n-1)<br>
ä»¥xä¸ºèµ·ç‚¹ï¼Œè¿æ¥çš„ç‚¹yä¸ºé¡ºæ—¶é’ˆ+1<br>
ä»yæ‰¾ä¸‹ä¸€ä¸ªç‚¹ï¼Œè¿æ¥çš„ç‚¹zä¸ºé€†æ—¶é’ˆ-2<br>
ç„¶åå½¢æˆä¸€ä¸ªzå­—ã€‚</p>
<pre><code class="language-cpp">#pragma GCC optimize(2)
#include&lt;bits/stdc++.h&gt;
using namespace std;
const int man = 2e5+10;
#define IOS ios::sync_with_stdio(0)
template &lt;typename T&gt;
inline T read(){T sum=0,fl=1;int ch=getchar();
for(;!isdigit(ch);ch=getchar())if(ch=='-')fl=-1;
for(;isdigit(ch);ch=getchar())sum=sum*10+ch-'0';
return sum*fl;}
template &lt;typename T&gt;
inline void write(T x) {static int sta[35];int top=0;
do{sta[top++]= x % 10, x /= 10;}while(x);
while (top) putchar(sta[--top] + 48);}
template&lt;typename T&gt;T gcd(T a, T b) {return b==0?a:gcd(b, a%b);}
template&lt;typename T&gt;T exgcd(T a,T b,T &amp;g,T &amp;x,T &amp;y){if(!b){g = a,x = 1,y = 0;}
else {exgcd(b,a%b,g,y,x);y -= x*(a/b);}}
#ifndef ONLINE_JUDGE
#define debug(fmt, ...) {printf(&quot;debug &quot;);printf(fmt,##__VA_ARGS__);puts(&quot;&quot;);}
#else
#define debug(fmt, ...)
#endif
typedef long long ll;
const ll mod = 1e9+7;

int main() {
    #ifndef ONLINE_JUDGE
        freopen(&quot;in.txt&quot;, &quot;r&quot;, stdin);
        //freopen(&quot;out.txt&quot;,&quot;w&quot;,stdout);
    #endif
    int t;
    cin &gt;&gt; t;
    int T = 0;
    while(t--){
        int n;cin &gt;&gt; n;
        printf(&quot;Case #%d: %d\n&quot;,++T,n/2);
        for(int i = 1;i &lt;= n/2;i++){
            int f = 1;
            int u = i - 1;
            for(int j = 1;j &lt; n;j++){
                int v = (u + j*f + n)%n;
                printf(&quot;%d %d\n&quot;,u+1,v+1);
                f *= -1;
                u = v;
            }
        }
    }
    return 0;
}
</code></pre>
<h1 id="ecave-escape"><a href="https://ac.nowcoder.com/acm/contest/4370/E">E	Cave Escape</a></h1>
<p>é¢˜æ„ï¼šç»™å®šä¸€ä¸ªnâˆ—mçš„æ ¼å­çŸ©é˜µï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªæ ¼å­æ˜¯èµ·ç‚¹ï¼Œä¸€ä¸ªæ ¼å­æ˜¯ç»ˆç‚¹ã€‚ä»èµ·ç‚¹å¼€å§‹ç§»åŠ¨ï¼Œæ¯æ¬¡èƒ½ç§»åŠ¨åˆ°æœ‰ç›¸é‚»è¾¹çš„æ ¼å­ä¸­ï¼Œæ¯ä¸ªæ ¼å­éƒ½æœ‰ä¸€ä¸ªæƒå€¼v,è‹¥ä»ç‚¹aç§»åŠ¨åˆ°ç‚¹bï¼Œä¸”bç‚¹æœªè¢«è®¿é—®è¿‡ï¼Œåˆ™å¯ä»¥è·å¾—Vaâˆ—Vbçš„æ”¶ç›Šï¼Œè‹¥ç§»åŠ¨åˆ°ç»ˆç‚¹ï¼Œå¯ä»¥é€‰æ‹©å…ˆä¸å‡ºå»ï¼Œç»§ç»­åœ¨å›¾ä¸Šä¹±èµ°ï¼Œé—®å¦‚ä½•å¯ä»¥ä½¿å¾—èµ°å‡ºç»ˆç‚¹åè·å¾—å¾—æ”¶ç›Šæœ€å¤§ï¼Ÿ(åªéœ€è¦è¾“å‡ºæœ€å¤§æ”¶ç›Šå³å¯)<br>
æ€è·¯ï¼šä¸ç®¡èµ·ç‚¹åœ¨å“ªé‡Œï¼Œå› ä¸ºæƒå€¼éƒ½ä¸ºæ­£æ•°ï¼Œæˆ‘ä»¬è¦è®©æ”¶ç›Šæœ€å¤§ï¼Œè‚¯å®šå°½é‡æ¯ä¸ªç‚¹éƒ½è®¿é—®ä¸€éï¼Œç„¶åæ‰æ˜¯æœ€å¤§çš„å€¼ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç›´æ¥å»ºå›¾ï¼Œç„¶åè·‘ä¸€éç”Ÿæˆæ ‘(æœ€å¤§),å› ä¸ºè¦è®©æ¯ä¸ªç‚¹è®¿é—®ä¸€æ¬¡ã€‚<br>
æ­£è§£çš„è¯å­˜å›¾æ˜¯æŠŠæƒå€¼ä½œä¸ºç´¢å¼•ï¼Œç„¶åä»å¤§åˆ°å°ä¸€æ¬¡æšä¸¾ï¼›<br>
ä¸€èˆ¬çš„åšæ³•å¯ä»¥å¡è¿‡å»ã€‚</p>
<h3 id="codeæ­£è§£805ms">code(æ­£è§£805ms)</h3>
<pre><code class="language-cpp">#pragma GCC optimize(2)
#include&lt;bits/stdc++.h&gt;
using namespace std;
const int man = 1e3+10;
#define IOS ios::sync_with_stdio(0)
template &lt;typename T&gt;
inline T read(){T sum=0,fl=1;int ch=getchar();
for(;!isdigit(ch);ch=getchar())if(ch=='-')fl=-1;
for(;isdigit(ch);ch=getchar())sum=sum*10+ch-'0';
return sum*fl;}
template &lt;typename T&gt;
inline void write(T x) {static int sta[35];int top=0;
do{sta[top++]= x % 10, x /= 10;}while(x);
while (top) putchar(sta[--top] + 48);}
template&lt;typename T&gt;T gcd(T a, T b) {return b==0?a:gcd(b, a%b);}
template&lt;typename T&gt;T exgcd(T a,T b,T &amp;g,T &amp;x,T &amp;y){if(!b){g = a,x = 1,y = 0;}
else {exgcd(b,a%b,g,y,x);y -= x*(a/b);}}
#ifndef ONLINE_JUDGE
#define debug(fmt, ...) {printf(&quot;debug &quot;);printf(fmt,##__VA_ARGS__);puts(&quot;&quot;);}
#else
#define debug(fmt, ...)
#endif
typedef long long ll;
const ll mod = 1e9+7;
int x[man*man],fa[man*man],va[man][man];
int sz[man*man];
vector&lt;pair&lt;int,int&gt; &gt;A[10010];
int find(int x){
    return x == fa[x] ? x : fa[x] = find(fa[x]);
}
/*
int find(int x){
    int p = x;
    while(p!=fa[p])p = fa[p];
    while(x!=p){
        int tp = fa[x];
        fa[x] = p;
        x = tp;
    }
    return p;
}*/
 
bool _union(int u,int v){
   // cout &lt;&lt; u &lt;&lt; &quot; 1\&quot; &quot; &lt;&lt; v &lt;&lt;endl;
    u = find(u);
    v = find(v);
  //  cout &lt;&lt; u &lt;&lt; &quot; 2\&quot; &quot; &lt;&lt; v &lt;&lt; endl;
    if(u==v)return true;
    if(sz[u]&gt;sz[v]){
        sz[u] += sz[v];
        fa[v] = u;
    }else fa[u] = v,sz[v] += sz[u];
    return false;
}
 
int main() {
    #ifndef ONLINE_JUDGE
        //freopen(&quot;in.txt&quot;, &quot;r&quot;, stdin);
        //freopen(&quot;out.txt&quot;,&quot;w&quot;,stdout);
    #endif
    int t;
    scanf(&quot;%d&quot;,&amp;t);
    int T = 0;
    while(t--){
        int n,m,s,a,b,c,p;
        for(int i = 0;i &lt;= 10000;i++)A[i].clear();
        scanf(&quot;%d%d%d%d%d%d&quot;,&amp;n,&amp;m,&amp;s,&amp;s,&amp;s,&amp;s);
        scanf(&quot;%d%d%d%d%d%d&quot;,x+1,x+2,&amp;a,&amp;b,&amp;c,&amp;p);
        fa[1] = 1;
        fa[2] = 2;
        for(int i = 3;i &lt;= n*m;i++){
            fa[i] = i;
            sz[i] = 1;
            x[i] = (a*x[i-1] + b*x[i-2] + c)%p;
        }
        int cnt = 0;
        for(int i = 1;i &lt;= n;i++){
            for(int j = 1;j &lt;= m;j++){
                va[i][j] = x[(i-1)*m + j];
                if(!va[i][j])continue;
                if(i&gt;1&amp;&amp;va[i-1][j])A[va[i][j]*va[i-1][j]].push_back(make_pair((i-1)*m + j,(i-2)*m + j));
                if(j&gt;1&amp;&amp;va[i][j-1])A[va[i][j]*va[i][j-1]].push_back(make_pair((i-1)*m + j,(i-1)*m + j - 1));
            }
        }
        ll ans = 0;
        int res = 0;
        for(int j = 10000;j &gt;= 0;j--){
            for(int i = 0;i &lt; A[j].size();i++){
                int u = A[j][i].first;
                int v = A[j][i].second;
                //cout &lt;&lt; A[i].w &lt;&lt; endl;
                if(!_union(u,v)){
                    ans += j;
                    res++;
                }if(res==n*m-1)break;
            }
            if(res==n*m-1)break;
        }
         
        printf(&quot;Case #%d: %lld\n&quot;,++T,ans);
    }
    return 0;
}
</code></pre>
<h3 id="codeæ™®é€šåšæ³•1719ms">code(æ™®é€šåšæ³•1719ms)</h3>
<pre><code class="language-cpp">#pragma GCC optimize(2)
#include&lt;bits/stdc++.h&gt;
using namespace std;
const int man = 1e3+10;
#define IOS ios::sync_with_stdio(0)
template &lt;typename T&gt;
inline T read(){T sum=0,fl=1;int ch=getchar();
for(;!isdigit(ch);ch=getchar())if(ch=='-')fl=-1;
for(;isdigit(ch);ch=getchar())sum=sum*10+ch-'0';
return sum*fl;}
template &lt;typename T&gt;
inline void write(T x) {static int sta[35];int top=0;
do{sta[top++]= x % 10, x /= 10;}while(x);
while (top) putchar(sta[--top] + 48);}
template&lt;typename T&gt;T gcd(T a, T b) {return b==0?a:gcd(b, a%b);}
template&lt;typename T&gt;T exgcd(T a,T b,T &amp;g,T &amp;x,T &amp;y){if(!b){g = a,x = 1,y = 0;}
else {exgcd(b,a%b,g,y,x);y -= x*(a/b);}}
#ifndef ONLINE_JUDGE
#define debug(fmt, ...) {printf(&quot;debug &quot;);printf(fmt,##__VA_ARGS__);puts(&quot;&quot;);}
#else
#define debug(fmt, ...)
#endif
typedef long long ll;
const ll mod = 1e9+7;
int x[man*man],fa[man*man],va[man][man];
int sz[man*man];
struct node{
    int u,v,w;
    bool operator &lt;(const node &amp;t)const{
        return w &gt; t.w;
    }
}A[2*man*man];
// int find(int x){
//     return x == fa[x] ? x : fa[x] = find(fa[x]);
// }
 
int find(int x){
    int p = x, t;
    while(p != fa[p]) p = fa[p];
    while(x != p){
        t = fa[x];
        fa[x] = p;
        x = t;
    }
    return x;
}
 
bool _union(int u,int v){
   // cout &lt;&lt; u &lt;&lt; &quot; 1\&quot; &quot; &lt;&lt; v &lt;&lt;endl;
    u = find(u);
    v = find(v);
  //  cout &lt;&lt; u &lt;&lt; &quot; 2\&quot; &quot; &lt;&lt; v &lt;&lt; endl;
    if(u==v)return true;
    if(sz[u]&gt;sz[v]){
        sz[u] += sz[v];
        fa[v] = u;
    }else fa[u] = v,sz[v] += sz[u];
    return false;
}
 
int main() {
    #ifndef ONLINE_JUDGE
        //freopen(&quot;in.txt&quot;, &quot;r&quot;, stdin);
        //freopen(&quot;out.txt&quot;,&quot;w&quot;,stdout);
    #endif
    int t;
    scanf(&quot;%d&quot;,&amp;t);
    int T = 0;
    while(t--){
        int n,m,s,a,b,c,p;
        scanf(&quot;%d%d%d%d%d%d&quot;,&amp;n,&amp;m,&amp;s,&amp;s,&amp;s,&amp;s);
        scanf(&quot;%d%d%d%d%d%d&quot;,x+1,x+2,&amp;a,&amp;b,&amp;c,&amp;p);
        fa[1] = 1;
        fa[2] = 2;
        for(int i = 3;i &lt;= n*m;i++){
            fa[i] = i;
            sz[i] = 1;
            x[i] = (a*x[i-1] + b*x[i-2] + c)%p;
        }
        int cnt = 0;
        for(int i = 1;i &lt;= n;i++){
            for(int j = 1;j &lt;= m;j++){
                va[i][j] = x[(i-1)*m + j];
                if(!va[i][j])continue;
                if(i&gt;1&amp;&amp;va[i-1][j])A[cnt++] = node{(i-1)*m + j,(i-2)*m + j,va[i][j]*va[i-1][j]};
                if(j&gt;1&amp;&amp;va[i][j-1])A[cnt++] = node{(i-1)*m + j,(i-1)*m + j - 1,va[i][j]*va[i][j-1]};
            }
        }
        //cout &lt;&lt; &quot;cnt:&quot; &lt;&lt; cnt &lt;&lt;endl;
        sort(A,A+cnt);
        ll ans = 0;
        int res = 0;
        for(int i = 0;i &lt; cnt;i++){
            int u = A[i].u;
            int v = A[i].v;
            int w = A[i].w;
            //cout &lt;&lt; A[i].w &lt;&lt; endl;
            if(!_union(u,v)){
                ans += w;
                res++;
            }
            if(res==n*m-1)break;
        }
        printf(&quot;Case #%d: %lld\n&quot;,++T,ans);
    }
    return 0;
}
</code></pre>
<h1 id="fa-simple-problem-on-a-tree"><a href="https://ac.nowcoder.com/acm/contest/4370/F">F	A Simple Problem On A Tree</a></h1>
<p>é¢˜æ„ï¼šä¸€æ£µæ ‘ï¼Œæœ‰æƒå€¼ï¼Œ4ç§æ“ä½œï¼Œ<br>
1ï¼šu,vè·¯å¾„ä¸Šçš„ç‚¹æƒå€¼å…¨éƒ¨ä¸ºw<br>
2ï¼šu,vè·¯å¾„ä¸Šçš„ç‚¹æƒå€¼å…¨éƒ¨åŠ w<br>
3ï¼šu,vè·¯å¾„ä¸Šçš„ç‚¹æƒå€¼å…¨éƒ¨ä¹˜w<br>
4ï¼šu,vè·¯å¾„ä¸Šçš„ç‚¹<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mi>w</mi><mn>3</mn></msup></mrow><annotation encoding="application/x-tex">w^3</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141079999999999em;vertical-align:0em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span></span></span></span></span></span></span></span>å’Œ</p>
<p>æ€è·¯ï¼š<br>
é¦–å…ˆè‚¯å®šæ˜¯è¦æŠŠæ ‘ä¸Šçš„æ“ä½œè½¬æ¢ä¸ºè¿ç»­åŒºé—´ï¼Œæ‰€ä»¥(æ ‘)åˆ¨ä¸€ä¸‹,ç„¶åæ¥ä¸‹æ¥å°±æ˜¯çº¿æ®µæ ‘æ“ä½œäº†ã€‚<br>
çº¿æ®µæ ‘æ“ä½œï¼š<br>
æ±‚<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mi>w</mi><mn>3</mn></msup></mrow><annotation encoding="application/x-tex">w^3</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141079999999999em;vertical-align:0em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span></span></span></span></span></span></span></span>çš„å’Œï¼Œæ‰€ä»¥æˆ‘ä»¬ç»´æŠ¤ä¸€ä¸ªsum3ï¼Œè¡¨ç¤º<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mi>w</mi><mn>3</mn></msup></mrow><annotation encoding="application/x-tex">w^3</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141079999999999em;vertical-align:0em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span></span></span></span></span></span></span></span>ã€‚å»ºæ ‘pushup(åˆå§‹æƒ…å†µ)<br>
ç„¶åå¯¹äºæ›´æ–°æ“ä½œï¼Œå‡è®¾a,b,c,åŠ ä¸Šxï¼Œ<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>(</mo><mi>a</mi><mo>+</mo><mi>x</mi><msup><mo>)</mo><mn>3</mn></msup><mo>+</mo><mo>(</mo><mi>b</mi><mo>+</mo><mi>x</mi><msup><mo>)</mo><mn>3</mn></msup><mo>+</mo><mo>(</mo><mi>c</mi><mo>+</mo><mi>x</mi><msup><mo>)</mo><mn>3</mn></msup><mo>=</mo><msup><mi>a</mi><mn>3</mn></msup><mo>+</mo><msup><mi>b</mi><mn>3</mn></msup><mo>+</mo><msup><mi>c</mi><mn>3</mn></msup><mo>+</mo><mn>3</mn><mo>âˆ—</mo><mi>x</mi><mo>âˆ—</mo><mo>(</mo><msup><mi>a</mi><mn>2</mn></msup><mo>+</mo><msup><mi>b</mi><mn>2</mn></msup><mo>+</mo><msup><mi>c</mi><mn>2</mn></msup><mo>)</mo><mo>+</mo><mn>3</mn><mo>âˆ—</mo><msup><mi>x</mi><mn>2</mn></msup><mo>âˆ—</mo><mo>(</mo><mi>a</mi><mo>+</mo><mi>b</mi><mo>+</mo><mi>c</mi><mo>)</mo><mo>+</mo><mn>3</mn><mo>âˆ—</mo><msup><mi>x</mi><mn>3</mn></msup></mrow><annotation encoding="application/x-tex">(a+x)^3 + (b + x)^3 + (c + x )^3 = a^3 + b^3 + c^3 +3*x*(a^2 + b^2 + c^2) + 3*x^2*(a+ b + c) + 3*x^3</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathdefault">a</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.064108em;vertical-align:-0.25em;"></span><span class="mord mathdefault">x</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathdefault">b</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.064108em;vertical-align:-0.25em;"></span><span class="mord mathdefault">x</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathdefault">c</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.064108em;vertical-align:-0.25em;"></span><span class="mord mathdefault">x</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.897438em;vertical-align:-0.08333em;"></span><span class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.897438em;vertical-align:-0.08333em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.897438em;vertical-align:-0.08333em;"></span><span class="mord"><span class="mord mathdefault">c</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">3</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.46528em;vertical-align:0em;"></span><span class="mord mathdefault">x</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.064108em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.897438em;vertical-align:-0.08333em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.064108em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathdefault">c</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">3</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.8141079999999999em;vertical-align:0em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathdefault">a</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.77777em;vertical-align:-0.08333em;"></span><span class="mord mathdefault">b</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">c</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">3</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.8141079999999999em;vertical-align:0em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span></span></span></span></span></span></span></span><br>
ç„¶åæˆ‘ä»¬å†ç»´æŠ¤ä¸€ä¸ªsum2(<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mi>w</mi><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">w^2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141079999999999em;vertical-align:0em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span>),sum1(<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>w</mi></mrow><annotation encoding="application/x-tex">w</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span></span></span></span>)ï¼Œè¿›è¡ŒåŒºé—´åŠ çš„æ—¶å€™ç›´æ¥åŠ ä¸Šè¿™ä¸ªå¼å­å°±okã€‚<br>
å¯¹äºä¹˜æ³•çš„è¯ï¼Œæˆ‘ä»¬åªéœ€è¦æŠŠè¿™ä¸ªåŒºé—´çš„sum3*<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mi>x</mi><mn>3</mn></msup></mrow><annotation encoding="application/x-tex">x^3</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141079999999999em;vertical-align:0em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span></span></span></span></span></span></span></span>å°±æ˜¯äº†ã€‚<br>
ç„¶åå¯¹äºæ“ä½œ1ï¼Œæˆ‘ä»¬å…ˆå¯¹è¿™ä¸ªåŒºé—´ä¹˜ä»¥0ï¼Œåœ¨åŠ ä¸Šwã€‚<br>
<mark>å¯¹äºlazyæ ‡è®°</mark><br>
æœ‰2ä¸ª(ä¹˜æ³•ï¼Œé™¤æ³•)æ ‡è®°ï¼Œad = 0,mu = 1.<br>
ç„¶åæˆ‘ä»¬æ˜¯å…ˆä¹˜è¿˜æ˜¯å…ˆåŠ ï¼Ÿ<br>
å‡è®¾æˆ‘ä»¬å…ˆä¹˜åœ¨åŠ ã€‚<br>
(a + x)<em>y = a</em>y + x*y<br>
æ‰€ä»¥æˆ‘ä»¬è¿˜æ˜¯å…ˆåŒºé—´ä¹˜ä¸Šyï¼Œç„¶åæŠŠè¿™ä¸ªåŒºé—´çš„adä¹˜ä¸Šyï¼Œç”¨æ›´æ–°è¿‡çš„adå»è¿›è¡ŒåŠ çš„æ“ä½œ<br>
å…ˆåŠ åœ¨ä¹˜çš„è¯å°±å¯ä»¥ä¾æ¬¡è¿›è¡Œã€‚</p>
<h1 id="code1989ms">Code(1989ms)</h1>
<pre><code class="language-cpp">#pragma GCC optimize(2)
#include&lt;bits/stdc++.h&gt;
using namespace std;
const int man = 2e5+10;
#define IOS ios::sync_with_stdio(0)
template &lt;typename T&gt;
inline T read(){T sum=0,fl=1;int ch=getchar();
for(;!isdigit(ch);ch=getchar())if(ch=='-')fl=-1;
for(;isdigit(ch);ch=getchar())sum=sum*10+ch-'0';
return sum*fl;}
template &lt;typename T&gt;
inline void write(T x) {static int sta[35];int top=0;
do{sta[top++]= x % 10, x /= 10;}while(x);
while (top) putchar(sta[--top] + 48);}
template&lt;typename T&gt;T gcd(T a, T b) {return b==0?a:gcd(b, a%b);}
template&lt;typename T&gt;T exgcd(T a,T b,T &amp;g,T &amp;x,T &amp;y){if(!b){g = a,x = 1,y = 0;}
else {exgcd(b,a%b,g,y,x);y -= x*(a/b);}}
#ifndef ONLINE_JUDGE
#define debug(fmt, ...) {printf(&quot;debug &quot;);printf(fmt,##__VA_ARGS__);puts(&quot;&quot;);}
#else
#define debug(fmt, ...)
#endif
typedef long long ll;
const ll mod = 1e9+7;

//#define int long long
vector&lt;int&gt;sp[man];
int va[man];
int top[man],rk[man],id[man],siz[man];
int son[man],fa[man],dep[man];
int cnt = 0;
void dfs1(int u,int f){
    siz[u] = 1;
    fa[u] = f;
    dep[u] = dep[f] + 1;
    for(int i = 0;i &lt; sp[u].size();i++){
        int v = sp[u][i];
        if(v==f)continue;
        dfs1(v,u);
        siz[u] += siz[v];
        if(siz[son[u]]&lt;siz[v]){
            son[u] = v;
        }
    }
}

void dfs2(int u,int tp){
    id[++cnt] = u;
    rk[u] = cnt;
    top[u] = tp;
    if(!son[u])return;
    dfs2(son[u],tp);
    for(int i = 0;i &lt; sp[u].size();i++){
        int v = sp[u][i];
        if(v==fa[u]||v==son[u])continue;
        dfs2(v,v);
    }
}

ll sum1[man&lt;&lt;2],sum2[man&lt;&lt;2],sum3[man&lt;&lt;2];
int ad[man&lt;&lt;2],mu[man&lt;&lt;2];
inline void add(ll &amp;x, int y){ 
    (x += y) &gt;= mod ?  x -= mod : x; 
}
inline void mul(ll &amp;x, int y){
    x = 1ll * x * y % mod; 
}
void pushup(int rt){
    sum1[rt] = (sum1[rt&lt;&lt;1] + sum1[rt&lt;&lt;1|1])%mod;
    sum2[rt] = (sum2[rt&lt;&lt;1] + sum2[rt&lt;&lt;1|1])%mod;
    sum3[rt] = (sum3[rt&lt;&lt;1] + sum3[rt&lt;&lt;1|1])%mod;
}

inline void pushdown1(int rt,int x,int y,int num){
    if(y!=1){//*
        int w1 = y;
        int w2 = 1ll*y*y%mod;
        int w3 = 1ll*w2*y%mod;
        mul(sum1[rt],w1);
        mul(sum2[rt],w2);
        mul(sum3[rt],w3);

        mu[rt] = 1ll*mu[rt]*y%mod;
        ad[rt] = 1ll*ad[rt]*y%mod;
    }
    if(x!=0){//+
        int w1 = x;
        int w2 = 1ll*x*x%mod;
        int w3 = 1ll*w2*x%mod;
        add(sum3[rt],3ll*w1%mod*sum2[rt]%mod);
        add(sum3[rt],3ll*w2%mod*sum1[rt]%mod);
        add(sum3[rt],1ll*num*w3%mod);

        add(sum2[rt],1ll*num*w2 % mod);
        add(sum2[rt],2LL*w1*sum1[rt] % mod);

        add(sum1[rt],1ll*num*w1%mod);

        ad[rt] = (1ll*ad[rt] + w1)%mod;
    }
}

inline void pushdown(int rt,int ls,int rs){
    int x = ad[rt];
    int y = mu[rt];
    pushdown1(rt&lt;&lt;1,x,y,ls);
    pushdown1(rt&lt;&lt;1|1,x,y,rs);
    ad[rt] = 0;
    mu[rt] = 1;
}

inline void build(int l,int r,int rt){
    sum1[rt] = sum2[rt] = sum3[rt] = 0;
    ad[rt] = 0;
    mu[rt] = 1;
    if(l==r){
        //cout &lt;&lt; &quot;l:&quot; &lt;&lt; l &lt;&lt; &quot; &quot; &lt;&lt; id[l] &lt;&lt; endl;
        sum1[rt] = va[id[l]];
        sum2[rt] = 1ll * va[id[l]] * va[id[l]] % mod;
        sum3[rt] = 1ll * sum2[rt] * va[id[l]] % mod;
        return;
    }
    int m = l + r &gt;&gt; 1;
    build(l,m,rt&lt;&lt;1);
    build(m+1,r,rt&lt;&lt;1|1);
    pushup(rt);
}

inline void update(int l,int r,int L,int R,int rt,int op,int v){
    if(L&lt;=l&amp;&amp;R&gt;=r){
        //æ›´æ–°
        if(op==1){
            pushdown1(rt,v,0,r - l + 1);
        }else if(2==op){
            pushdown1(rt,v,1,r - l + 1);
        }else{
            pushdown1(rt,0,v,r - l + 1);
        }
        return;
    }
    int m = l + r &gt;&gt; 1;
    pushdown(rt,m-l+1,r-m);
    if(L&lt;=m)update(l,m,L,R,rt&lt;&lt;1,op,v);
    if(R&gt;m)update(m+1,r,L,R,rt&lt;&lt;1|1,op,v);
    pushup(rt);
}

inline int query(int l,int r,int L,int R,int rt){
    if(L&lt;=l&amp;&amp;R&gt;=r){
        //cout &lt;&lt; l &lt;&lt; &quot; l:r &quot; &lt;&lt; r &lt;&lt; &quot; &quot; &lt;&lt; L &lt;&lt; &quot; L:R &quot; &lt;&lt; R &lt;&lt;endl;
        return sum3[rt];
    }
    int m = l + r &gt;&gt; 1;
    pushdown(rt,m-l+1,r-m);
    int ans = 0;
    if(L&lt;=m)ans = (ans + query(l,m,L,R,rt&lt;&lt;1))%mod;
    if(R&gt;m)ans = (ans + query(m+1,r,L,R,rt&lt;&lt;1|1))%mod;
    pushup(rt);
    return ans;
}

void update(int u,int v,int op,int V){
    while(top[u]!=top[v]){
        if(dep[top[u]]&lt;dep[top[v]]){
            swap(u,v);
        }
        update(1,cnt,rk[top[u]],rk[u],1,op,V);
        u = fa[top[u]];
    }
    if(dep[u]&lt;dep[v])swap(u,v);
    update(1,cnt,rk[v],rk[u],1,op,V);
}

ll query(int u,int v){
    ll ans = 0;
    while(top[u]!=top[v]){
        if(dep[top[u]]&lt;dep[top[v]]){
            swap(u,v);
        }
        int tp = query(1,cnt,rk[top[u]],rk[u],1);
        add(ans,tp);
        //cout &lt;&lt;&quot;u:&quot; &lt;&lt; u &lt;&lt; &quot; &quot; &lt;&lt; v &lt;&lt; &quot; &quot; &lt;&lt; top[u] &lt;&lt; &quot; &quot; &lt;&lt; u  &lt;&lt; &quot; &quot; &lt;&lt; ans &lt;&lt; &quot;tp:&quot; &lt;&lt; tp &lt;&lt; endl;
        u = fa[top[u]];
    }
    if(dep[u]&lt;dep[v])swap(u,v);
    add(ans,query(1,cnt,rk[v],rk[u],1));
    //cout &lt;&lt;&quot;u:&quot; &lt;&lt; u &lt;&lt; &quot; &quot; &lt;&lt; v &lt;&lt; &quot; &quot; &lt;&lt; top[u] &lt;&lt; &quot; &quot; &lt;&lt; u &lt;&lt;&quot; &quot; &lt;&lt; ans &lt;&lt; endl;
    return ans;
}

signed main() {
    #ifndef ONLINE_JUDGE
        freopen(&quot;in.txt&quot;, &quot;r&quot;, stdin);
        //freopen(&quot;out.txt&quot;,&quot;w&quot;,stdout);
    #endif
    int t,T = 0;
    scanf(&quot;%d&quot;,&amp;t);
    //cout &lt;&lt; t &lt;&lt; endl;
    while(t--){
        int n;
        scanf(&quot;%d&quot;,&amp;n);
        for(int i = 1;i &lt;= n;i++)sp[i].clear(),son[i] = 0;
        for(int i = 1;i &lt; n;i++){
            int u,v;
            scanf(&quot;%d%d&quot;,&amp;u,&amp;v);
            sp[u].push_back(v);
            sp[v].push_back(u);
        }
        for(int i = 1;i &lt;= n;i++)scanf(&quot;%d&quot;,&amp;va[i]);
        dep[0] = 0;cnt = 0;
        dfs1(1,0);
        dfs2(1,1);
        build(1,cnt,1);
        //cout &lt;&lt; &quot;!!!!&quot; &lt;&lt; endl;
        printf(&quot;Case #%d: \n&quot;,++T);
        int q;scanf(&quot;%d&quot;,&amp;q);
        while(q--){
            int op,u,v,w;
            scanf(&quot;%d&quot;,&amp;op);
            scanf(&quot;%d%d&quot;,&amp;u,&amp;v);
            if(4!=op){
                scanf(&quot;%d&quot;,&amp;w);
                update(u,v,op,w);
            }else{
                printf(&quot;%d\n&quot;,query(u,v));
            }
        }
    }   
    return 0;
}
</code></pre>

            </div>
            
            
              <div class="next-post">
                <div class="next">ä¸‹ä¸€ç¯‡</div>
                <a href="https://nofuck.github.io/post/hello-gridea/">
                  <h3 class="post-title">
                    Hello Gridea
                  </h3>
                </a>
              </div>
            

            

          </div>

        </div>
      </div>
    </div>

    <script src="https://unpkg.com/aos@next/dist/aos.js"></script>
<script type="application/javascript">

AOS.init();

var app = new Vue({
  el: '#app',
  data: {
    menuVisible: false,
  },
})

</script>


  <script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
  <script>
    hljs.initHighlightingOnLoad()
  </script>





  </body>
</html>
